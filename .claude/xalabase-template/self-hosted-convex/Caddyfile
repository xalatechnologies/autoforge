# Convex API - main backend (HTTPS with domain)
convex-api.digilist.no {
    reverse_proxy backend:3210
}

# Convex HTTP Actions (HTTPS with domain)
convex.digilist.no {
    reverse_proxy backend:3211
}

# Convex Dashboard (HTTPS with domain)
convex-dashboard.digilist.no {
    reverse_proxy dashboard:6791
}

# Fallback: Direct IP access on HTTP (while DNS propagates)
:80 {
    @api host 72.61.23.56
    handle @api {
        reverse_proxy backend:3210
    }

    # Default handler for unknown hosts
    handle {
        respond "Convex Self-Hosted - Please use https://convex-api.digilist.no" 200
    }
}

# API on port 8080 as HTTP fallback (no SSL)
:8080 {
    reverse_proxy backend:3210
}

# Dashboard on port 8081 as HTTP fallback
:8081 {
    reverse_proxy dashboard:6791
}
