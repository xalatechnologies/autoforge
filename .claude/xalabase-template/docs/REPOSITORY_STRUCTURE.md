# XalaBaaS Repository Structure

This document provides a complete annotated directory tree of the XalaBaaS monorepo, including file counts, descriptions of each directory's purpose, and identification of which files contain real logic versus re-exports.

---

## Legend

| Symbol | Meaning |
|--------|---------|
| (RE-EXPORT) | File contains only `export * from '...'` -- no real logic |
| (REAL LOGIC) | File contains actual implementation code |
| (GENERATED) | Auto-generated by Convex or build tools -- never edit |

---

## Root Directory

```
xalabase-template/
├── apps/                               # 5 React applications + docs site
├── convex/                             # Convex backend (thin re-exports + config)
├── packages/                           # 8 shared npm packages
├── scripts/                            # Build, deploy, and utility scripts
├── tests/                              # Test suites (Vitest + Playwright)
├── data/                               # Static seed data (JSON)
├── docs/                               # Architecture documentation
├── patches/                            # pnpm patch overrides
├── public/                             # Static assets (seed images)
├── self-hosted-convex/                 # Self-hosted Convex deployment config
├── .claude/                            # Claude Code settings
├── .cursor/                            # Cursor IDE rules and skills
├── .github/                            # GitHub Actions CI
├── CLAUDE.md                           # AI agent instructions (REAL LOGIC)
├── README.md                           # Project overview (REAL LOGIC)
├── package.json                        # Root workspace config
├── pnpm-workspace.yaml                 # pnpm workspace definition
├── pnpm-lock.yaml                      # Lock file
├── tsconfig.json                       # Root TypeScript config
├── vitest.config.ts                    # Root Vitest config
├── playwright.config.ts               # Playwright E2E config
├── convex.json                         # Convex project config
├── .env.example                        # Environment variable template
├── .env.local                          # Local environment (gitignored)
├── .gitignore                          # Git ignore rules
└── .npmrc                              # npm/pnpm settings
```

---

## apps/ -- Experience Plane (84 source files)

Five React applications that serve as thin shells. They compose providers, define routes, and import everything from shared packages. No business logic lives here.

```
apps/
├── backoffice/                         # Admin management + case handling
│   ├── src/                            # 44 source files
│   │   ├── App.tsx                     # Route definitions (REAL LOGIC)
│   │   ├── main.tsx                    # Entry point, provider composition (REAL LOGIC)
│   │   └── ...                         # Route components
│   ├── index.html                      # Vite HTML entry
│   ├── package.json                    # @xalabaas/backoffice, port 5175
│   ├── vite.config.ts                  # Vite config
│   ├── tsconfig.json                   # TypeScript config
│   └── eslint.config.js               # ESLint config
│
├── dashboard/                          # Analytics dashboard
│   ├── src/                            # 2 source files
│   ├── package.json                    # @xalabaas/dashboard
│   └── eslint.config.js
│
├── docs/                               # Developer documentation site (VitePress)
│   ├── .vitepress/                     # VitePress config
│   ├── architecture/                   # Architecture docs (markdown)
│   ├── index.md                        # Landing page
│   └── package.json                    # @xalabaas/dev-docs
│
├── minside/                            # User "My Pages" portal
│   ├── src/                            # 25 source files
│   │   ├── App.tsx                     # Route definitions (REAL LOGIC)
│   │   ├── main.tsx                    # Entry point (REAL LOGIC)
│   │   └── ...                         # Route components
│   ├── index.html
│   ├── package.json                    # @xalabaas/minside, port 5174
│   ├── vite.config.ts
│   ├── tsconfig.json
│   └── eslint.config.js
│
├── saas-admin/                         # SaaS platform admin
│   ├── src/                            # 10 source files
│   ├── index.html
│   ├── package.json                    # @xalabaas/saas-admin, port 6005
│   ├── vite.config.ts
│   ├── tsconfig.json
│   ├── tsconfig.node.json
│   └── eslint.config.js
│
└── web/                                # Public booking platform
    ├── src/                            # 3 source files
    │   ├── App.tsx                     # All routes in one file (REAL LOGIC)
    │   ├── main.tsx                    # Entry point (REAL LOGIC)
    │   └── vite-env.d.ts
    ├── index.html
    ├── package.json                    # @xalabaas/web, port 5190
    ├── vite.config.ts
    ├── tsconfig.json
    └── eslint.config.js
```

### App Design System Mapping

| App | Design System | Port | Package Name |
|-----|---------------|------|-------------|
| backoffice | @xala/ds (digdir) | 5175 | @xalabaas/backoffice |
| minside | @xala/ds (digdir) | 5174 | @xalabaas/minside |
| web | @xala/ds (digdir) | 5190 | @xalabaas/web |
| saas-admin | @xala-technologies/platform-ui | 6005 | @xalabaas/saas-admin |
| dashboard | @xala-technologies/platform-ui | -- | @xalabaas/dashboard |

---

## convex/ -- Control Plane (~200 source files, ~85% are re-exports)

The Convex backend directory. Convex requires function files here for its file-based routing. Most files are single-line re-exports pointing to `packages/shared/src/features/`. Only configuration, schema, seeds, and HTTP routing contain real logic.

```
convex/
├── _generated/                         # Auto-generated Convex types (GENERATED)
│   ├── api.ts                          # Typed API references
│   ├── dataModel.ts                    # Table type definitions
│   └── server.ts                       # Server function helpers
│
├── components/                         # 18 component directories (119 files)
│   ├── addons/                         # 7 files (1 real, 6 re-exports)
│   │   ├── convex.config.ts            # defineComponent("addons") (REAL LOGIC)
│   │   ├── schema.ts                   # (RE-EXPORT)
│   │   ├── functions.ts               # (RE-EXPORT)
│   │   ├── contract.ts                # (RE-EXPORT)
│   │   ├── index.ts                   # (RE-EXPORT)
│   │   ├── mutations.ts              # (RE-EXPORT)
│   │   └── _generated/                # (GENERATED)
│   ├── analytics/                      # 5 files (1 real, 4 re-exports)
│   ├── audit/                          # 7 files (1 real, 6 re-exports)
│   ├── auth/                           # 6 files (1 real, 5 re-exports)
│   ├── billing/                        # 7 files (1 real, 6 re-exports)
│   ├── bookings/                       # 9 files (1 real, 8 re-exports)
│   ├── catalog/                        # 7 files (1 real, 6 re-exports)
│   ├── compliance/                     # 6 files (1 real, 5 re-exports)
│   ├── integrations/                   # 6 files (1 real, 5 re-exports)
│   ├── messaging/                      # 7 files (1 real, 6 re-exports)
│   ├── notifications/                  # 5 files (1 real, 4 re-exports)
│   ├── pricing/                        # 11 files (1 real, 10 re-exports)
│   ├── rbac/                           # 7 files (1 real, 6 re-exports)
│   ├── resources/                      # 6 files (1 real, 5 re-exports)
│   ├── reviews/                        # 5 files (1 real, 4 re-exports)
│   ├── seasons/                        # 7 files (1 real, 6 re-exports)
│   ├── tenant-config/                  # 6 files (1 real, 5 re-exports)
│   └── user-prefs/                     # 5 files (1 real, 4 re-exports)
│
├── domain/                             # 25 facade re-export files + tests
│   ├── __tests__/                      # Domain facade tests
│   ├── bookings.ts                     # (RE-EXPORT) -> features/bookings/convex/bookings
│   ├── reviews.ts                      # (RE-EXPORT) -> features/reviews/convex/reviews
│   ├── allocations.ts                  # (RE-EXPORT) -> features/bookings/convex/allocations
│   ├── amenities.ts                    # (RE-EXPORT) -> features/catalog/convex/amenities (via listings)
│   ├── audit.ts                        # (RE-EXPORT) -> features/audit/convex/audit
│   ├── authSessions.ts                 # (RE-EXPORT) -> features/auth/convex/authSessions
│   ├── billing.ts                      # (RE-EXPORT) -> features/billing/convex/billing
│   ├── blocks.ts                       # (RE-EXPORT) -> features/calendar/convex/blocks
│   ├── bookingAddons.ts                # (RE-EXPORT) -> features/bookings/convex/bookingAddons
│   ├── categories.ts                   # (RE-EXPORT) -> features/catalog/convex/categories
│   ├── favorites.ts                    # (RE-EXPORT) -> features/user-prefs/convex/favorites
│   ├── featureFlags.ts                 # (RE-EXPORT) -> features/tenant-config/convex/featureFlags
│   ├── messaging.ts                    # (RE-EXPORT) -> features/messaging/convex/messaging
│   ├── moduleRegistry.ts              # (RE-EXPORT) -> features/tenant-config/convex/moduleRegistry
│   ├── notifications.ts               # (RE-EXPORT) -> features/notifications/convex/notifications
│   ├── pricing.ts                      # (RE-EXPORT) -> features/pricing/convex/pricing
│   ├── rbacFacade.ts                   # (RE-EXPORT) -> features/rbac/convex/rbacFacade
│   ├── resources.ts                    # (RE-EXPORT) -> features/resources/convex/resources
│   ├── search.ts                       # (RE-EXPORT) -> features/listings/convex/search
│   ├── seasonalLeases.ts              # (RE-EXPORT) -> features/seasons/convex/seasonalLeases
│   ├── seasonApplications.ts          # (RE-EXPORT) -> features/seasons/convex/seasonApplications
│   ├── seasons.ts                      # (RE-EXPORT) -> features/seasons/convex/seasons
│   ├── addons.ts                       # (RE-EXPORT) -> features/addons/convex/addons
│   ├── additionalServices.ts          # (RE-EXPORT) -> features/addons/convex/additionalServices
│   └── DOMAIN.md                       # Domain mapping documentation
│
├── lib/                                # 12 infrastructure re-export files
│   ├── index.ts                        # (RE-EXPORT) -> features/_shared/lib
│   ├── auth.ts                         # (RE-EXPORT) -> features/_shared/lib/auth
│   ├── batchGet.ts                     # (RE-EXPORT) -> features/_shared/lib/batchGet
│   ├── componentContract.ts            # (RE-EXPORT) -> features/_shared/lib/componentContract
│   ├── componentMiddleware.ts          # (RE-EXPORT) -> features/_shared/lib/componentMiddleware
│   ├── crud.ts                         # (RE-EXPORT) -> features/_shared/lib/crud
│   ├── eventBus.ts                     # (RE-EXPORT) -> features/_shared/lib/eventBus
│   ├── functions.ts                    # (RE-EXPORT) -> features/_shared/lib/functions
│   ├── rateLimits.ts                   # (RE-EXPORT) -> features/_shared/lib/rateLimits
│   ├── rls.ts                          # (RE-EXPORT) -> features/_shared/lib/rls
│   ├── triggers.ts                     # (RE-EXPORT) -> features/_shared/lib/triggers
│   └── validators.ts                   # (RE-EXPORT) -> features/_shared/lib/validators
│
├── admin/                              # 4 re-export files
│   ├── amenities.ts                    # (RE-EXPORT)
│   ├── categories.ts                   # (RE-EXPORT)
│   ├── cleanup.ts                      # (RE-EXPORT)
│   └── stats.ts                        # (RE-EXPORT)
│
├── auth/                               # 10 re-export files
│   ├── callback.ts                     # (RE-EXPORT) -> features/auth/convex/callback
│   ├── claims.ts                       # (RE-EXPORT)
│   ├── demoToken.ts                    # (RE-EXPORT)
│   ├── link.ts                         # (RE-EXPORT)
│   ├── magicLink.ts                    # (RE-EXPORT)
│   ├── oauthStates.ts                  # (RE-EXPORT)
│   ├── password.ts                     # (RE-EXPORT)
│   ├── seedTestUsers.ts                # (RE-EXPORT)
│   ├── sessions.ts                     # (RE-EXPORT)
│   └── start.ts                        # (RE-EXPORT)
│
├── billing/                            # 2 re-export files
│   ├── vipps.ts                        # (RE-EXPORT)
│   └── webhooks.ts                     # (RE-EXPORT)
│
├── integrations/                       # 1 re-export file
│   └── altinn.ts                       # (RE-EXPORT)
│
├── monitoring/                         # 2 re-export files
│   ├── dashboard.ts                    # (RE-EXPORT)
│   └── index.ts                        # (RE-EXPORT)
│
├── modules/                            # 1 re-export file
│   └── index.ts                        # (RE-EXPORT) -> features/_shared/convex/modules
│
├── ops/                                # 1 re-export file
│   └── index.ts                        # (RE-EXPORT) -> features/_shared/convex/ops
│
├── organizations/                      # 1 re-export file
│   └── index.ts                        # (RE-EXPORT) -> features/organizations/convex
│
├── tenants/                            # 1 re-export file
│   └── index.ts                        # (RE-EXPORT) -> features/tenant-config/convex
│
├── users/                              # 2 re-export files
│   ├── index.ts                        # (RE-EXPORT) -> features/organizations/convex
│   └── mutations.ts                    # (RE-EXPORT)
│
├── migrations/                         # 1 file
│   └── index.ts                        # Migration orchestration (REAL LOGIC)
│
├── seeds/                              # 7 files (all REAL LOGIC)
│   ├── index.ts                        # Seed orchestrator
│   ├── categories.ts                   # Category seed data
│   ├── amenities.ts                    # Amenity seed data
│   ├── images.ts                       # Image seed data
│   ├── locations.ts                    # Location seed data
│   ├── types.ts                        # Seed data types
│   └── data/                           # JSON seed data files
│
├── convex.config.ts                    # App config, registers 18 components (REAL LOGIC)
├── schema.ts                           # 9 core tables (REAL LOGIC)
├── http.ts                             # HTTP route handler (REAL LOGIC)
├── seeds.ts                            # Core table seeding (REAL LOGIC)
├── seedComponents.ts                   # Component table seeding (REAL LOGIC)
├── storage.ts                          # (RE-EXPORT) -> features/_shared/convex/storage
├── types.ts                            # (RE-EXPORT) -> features/_shared/convex/types
├── tsconfig.json                       # TypeScript config
└── README.md                           # Convex directory conventions
```

### Convex File Breakdown

| Category | File Count | Description |
|----------|-----------|-------------|
| Re-exports | ~150 | Single-line `export *` pointing to features/ |
| Real logic | ~15 | Config, schema, seeds, HTTP, migrations |
| Generated | ~80 | `_generated/` directories (auto-generated) |

---

## packages/ -- Shared Packages (608 source files)

Eight npm packages shared across applications. The `shared` package is by far the largest, containing all 23 feature modules.

```
packages/
├── shared/                             # SINGLE SOURCE OF TRUTH (408 source files)
│   ├── src/
│   │   ├── features/                   # 23 feature modules + _shared (392 files)
│   │   │   ├── _shared/                # Cross-cutting infrastructure (26 files)
│   │   │   │   ├── lib/                # Convex infrastructure (12 files, all REAL LOGIC)
│   │   │   │   │   ├── auth.ts         # Auth helpers (requireActiveUser, etc.)
│   │   │   │   │   ├── batchGet.ts     # Batch data fetching
│   │   │   │   │   ├── componentContract.ts  # defineContract() for component APIs
│   │   │   │   │   ├── componentMiddleware.ts # hasModuleEnabled, hasFeatureFlag
│   │   │   │   │   ├── crud.ts         # CRUD operation helpers
│   │   │   │   │   ├── eventBus.ts     # Outbox pattern + emitEvent helper
│   │   │   │   │   ├── functions.ts    # Tenant-aware function builders
│   │   │   │   │   ├── rateLimits.ts   # Per-tenant/user rate limiting
│   │   │   │   │   ├── rls.ts          # Row-level security
│   │   │   │   │   ├── triggers.ts     # Database triggers
│   │   │   │   │   ├── validators.ts   # Shared validators
│   │   │   │   │   └── index.ts        # Barrel export
│   │   │   │   ├── hooks/              # Shared React hook utilities (4 files)
│   │   │   │   │   ├── convex-utils.ts # Cached query hooks (convex-helpers)
│   │   │   │   │   ├── convex-api.ts   # Generated API + typed IDs
│   │   │   │   │   ├── transforms/     # Pagination + response wrappers
│   │   │   │   │   │   ├── common.ts
│   │   │   │   │   │   └── index.ts
│   │   │   │   │   └── index.ts
│   │   │   │   ├── convex/             # App-level cross-cutting functions (6 files)
│   │   │   │   │   ├── types.ts        # Status enums, doc types
│   │   │   │   │   ├── storage.ts      # File storage API
│   │   │   │   │   ├── modules.ts      # Feature module catalog
│   │   │   │   │   ├── ops.ts          # System health/metrics
│   │   │   │   │   ├── cleanup.ts      # Data consolidation
│   │   │   │   │   └── index.ts
│   │   │   │   ├── use-help.ts         # FAQ/guides hook
│   │   │   │   ├── use-accessibility-monitoring.ts  # A11y metrics hook
│   │   │   │   └── index.ts
│   │   │   │
│   │   │   ├── auth/                   # 27 files -- Sessions, OAuth, magic links
│   │   │   ├── bookings/              # 21 files -- Bookings, allocations, conflicts
│   │   │   ├── listings/              # 27 files -- Search, favorites, geocode
│   │   │   ├── calendar/              # 21 files -- Block scheduling
│   │   │   ├── seasons/               # 21 files -- Seasons, applications, leases
│   │   │   ├── pricing/               # 20 files -- Pricing groups, discounts
│   │   │   ├── billing/               # 18 files -- Payments, invoices, Vipps
│   │   │   ├── catalog/               # 17 files -- Categories, amenity groups
│   │   │   ├── addons/                # 17 files -- Addons, additional services
│   │   │   ├── tenant-config/         # 17 files -- Feature flags, branding
│   │   │   ├── reviews/               # 16 files -- Reviews with moderation
│   │   │   ├── messaging/             # 16 files -- Conversations, messages
│   │   │   ├── audit/                 # 15 files -- Audit logging
│   │   │   ├── analytics/             # 14 files -- Metrics, report schedules
│   │   │   ├── integrations/          # 14 files -- Integration configs, webhooks
│   │   │   ├── rbac/                  # 14 files -- Roles, user-role bindings
│   │   │   ├── resources/             # 14 files -- Resource management
│   │   │   ├── notifications/         # 13 files -- In-app notifications
│   │   │   ├── compliance/            # 12 files -- Consent, DSAR, policies
│   │   │   ├── dashboard/             # 12 files -- Dashboard KPIs
│   │   │   ├── user-prefs/            # 11 files -- Favorites, saved filters
│   │   │   ├── organizations/         # 8 files  -- Org + user management
│   │   │   └── index.ts               # Barrel export for all features
│   │   │
│   │   ├── types/                      # Shared TypeScript types (10 files)
│   │   │   ├── common.ts              # Id, Timestamp, Pricing, Location, Image
│   │   │   ├── auth.ts                # User, Session, Role, Permission
│   │   │   ├── tenant.ts              # Tenant, Organization, TenantUser
│   │   │   ├── listing.ts             # Listing, ListingType, ListingStatus
│   │   │   ├── booking.ts             # Booking, BookingStatus, TimeSlot
│   │   │   ├── category.ts            # Category, CategoryOption
│   │   │   ├── amenity.ts             # Amenity, AmenityGroup
│   │   │   ├── filter.ts              # ListingFilterState, FilterOption
│   │   │   ├── api.ts                 # PaginatedResponse, ApiError
│   │   │   └── index.ts               # Barrel export
│   │   ├── hooks/                      # Shared hook utilities
│   │   ├── constants.ts                # Shared constants (APPS, LOCALES)
│   │   ├── navigation.ts              # Navigation config
│   │   ├── index.ts                    # Main barrel export
│   │   └── types.ts                    # Legacy type re-exports
│   ├── package.json                    # @xalabaas/shared
│   ├── tsconfig.json
│   └── tsup.config.ts                 # Build config
│
├── sdk/                                # SDK hooks layer (58 source files)
│   ├── src/
│   │   ├── hooks/                      # ~35 hook re-export files
│   │   │   ├── index.ts               # Master barrel export (REAL LOGIC)
│   │   │   ├── convex-utils.ts        # Query helpers (REAL LOGIC)
│   │   │   ├── use-reviews.ts         # (RE-EXPORT) -> features/reviews/hooks
│   │   │   ├── use-bookings.ts        # (RE-EXPORT) -> features/bookings/hooks
│   │   │   ├── use-auth.ts            # (RE-EXPORT) -> features/auth/hooks
│   │   │   ├── use-resources.ts       # (RE-EXPORT) -> features/resources/hooks
│   │   │   ├── use-listings.ts        # (RE-EXPORT) -> features/listings/hooks
│   │   │   ├── use-notifications.ts   # (RE-EXPORT) -> features/notifications/hooks
│   │   │   ├── use-billing.ts         # (RE-EXPORT) -> features/billing/hooks
│   │   │   ├── use-favorites.ts       # (RE-EXPORT) -> features/user-prefs/hooks
│   │   │   ├── use-categories.ts      # (RE-EXPORT) -> features/catalog/hooks
│   │   │   ├── use-pricing.ts         # (RE-EXPORT) -> features/pricing/hooks
│   │   │   ├── use-seasons.ts         # (RE-EXPORT) -> features/seasons/hooks
│   │   │   ├── use-messaging.ts       # (RE-EXPORT) -> features/messaging/hooks (use-conversations)
│   │   │   └── ...                     # 20+ more re-export files
│   │   ├── __tests__/                  # SDK unit tests
│   │   │   ├── hooks/                  # Hook tests (use-auth, use-bookings, use-resources)
│   │   │   ├── mocks/                  # Convex mock setup
│   │   │   ├── setup.ts               # Test setup
│   │   │   └── use-reviews.test.ts    # Reviews hook tests
│   │   ├── compat/                     # Backward compatibility layer (4 files)
│   │   │   ├── client-factory.ts      # Legacy React Query client factory
│   │   │   ├── query-keys.ts          # Legacy query key constants
│   │   │   ├── realtime.ts            # Legacy realtime subscription adapter
│   │   │   └── index.ts
│   │   ├── transforms/                # Data transformation utilities
│   │   ├── utils/                      # Utility functions
│   │   ├── convex-provider.tsx         # Convex client initialization (REAL LOGIC)
│   │   ├── convex-api.ts              # API type re-exports
│   │   ├── constants.ts                # SDK constants
│   │   ├── formatters.ts              # Display formatters
│   │   ├── types.ts                    # SDK type definitions
│   │   ├── upload.ts                   # File upload utilities
│   │   ├── index.ts                    # Main barrel export
│   │   └── vite-env.d.ts
│   ├── package.json                    # @xalabaas/sdk
│   ├── tsconfig.json
│   └── vitest.config.ts               # SDK test config
│
├── app-shell/                          # Provider composition + guards (16 source files)
│   ├── src/
│   │   ├── providers/                  # React context providers
│   │   │   ├── XalaProviders.tsx       # Master provider composer (REAL LOGIC)
│   │   │   ├── AuthProvider.tsx        # Auth state management (REAL LOGIC)
│   │   │   ├── AccountContextProvider.tsx  # Account context (REAL LOGIC)
│   │   │   ├── RealtimeProvider.tsx    # WebSocket real-time updates (REAL LOGIC)
│   │   │   ├── ToastProvider.tsx       # Toast notifications (REAL LOGIC)
│   │   │   └── index.ts
│   │   ├── auth/                       # Auth utilities
│   │   ├── hooks/                      # App-shell hooks
│   │   ├── layout/                     # Shared layout components
│   │   ├── guards.tsx                  # RequireAuth, RequirePermission, RequireModule
│   │   ├── types.ts                    # App-shell type definitions
│   │   └── index.ts                    # Barrel export
│   ├── package.json                    # @xalabaas/app-shell
│   ├── tsconfig.json
│   └── tsup.config.ts                 # Build config
│
├── ds/                                 # Design system (106 source files)
│   ├── src/                            # Component library based on Designsystemet
│   ├── dist/                           # Built output
│   ├── HEADER.md                       # DS header documentation
│   ├── STRUCTURE.md                    # DS component structure
│   ├── package.json                    # @xala/ds
│   └── tsconfig.json
│
├── ds-themes/                          # Theme tokens (3 source files)
│   ├── src/                            # Theme definitions
│   ├── themes/                         # Theme JSON files
│   ├── generated/                      # Auto-generated CSS
│   ├── scripts/                        # Theme generation scripts
│   ├── package.json                    # @xala/ds-themes
│   └── tsconfig.json
│
├── ds-registry/                        # Component registry (7 source files)
│   ├── src/                            # Registry implementation
│   ├── examples/                       # Usage examples
│   ├── registry.json                   # Component registry data
│   ├── package.json                    # @xala/ds-registry
│   └── tsconfig.json
│
├── i18n/                               # Internationalization (1 source file)
│   ├── src/                            # i18next setup
│   ├── locales/                        # Translation files
│   │   ├── nb.json                     # Norwegian Bokmal (default)
│   │   ├── en.json                     # English
│   │   └── ar.json                     # Arabic (RTL)
│   ├── package.json                    # @xalabaas/i18n
│   ├── tsconfig.json
│   └── tsup.config.ts                 # Build config
│
└── eslint-config/                      # Shared ESLint config
    ├── index.js                        # Base config
    ├── apps.js                         # App-specific rules
    ├── packages.js                     # Package-specific rules
    └── package.json                    # @xalabaas/eslint-config
```

---

## Feature Module Internal Structure

Each of the 23 feature modules follows the same self-contained vertical slice pattern:

```
features/{domain}/
├── __tests__/                          # Unit tests for this feature
│   └── index.test.ts
├── convex/                             # Convex backend functions
│   ├── _generated/                     # Auto-generated by Convex (GENERATED)
│   │   ├── api.ts
│   │   ├── component.ts
│   │   ├── dataModel.ts
│   │   └── server.ts
│   ├── convex.config.ts               # Component definition (REAL LOGIC)
│   ├── schema.ts                       # Component tables, uses v.string() (REAL LOGIC)
│   ├── functions.ts                    # Component queries + mutations (REAL LOGIC)
│   ├── contract.ts                     # API contract definition (REAL LOGIC)
│   ├── {domain}.ts                     # Facade functions (REAL LOGIC)
│   ├── queries.ts                      # Additional queries (stub or REAL LOGIC)
│   ├── mutations.ts                    # Additional mutations (stub or REAL LOGIC)
│   └── index.ts                        # Barrel export
├── hooks/                              # React hooks
│   ├── use-{domain}.ts                # Domain-specific hooks (REAL LOGIC)
│   └── index.ts                        # Barrel export
├── adapters/                           # Data transformation adapters
│   └── index.ts                        # (stub or REAL LOGIC)
├── presenters/                         # Presentation/formatting logic
│   └── index.ts                        # (stub or REAL LOGIC)
├── utils/                              # Domain utility functions
│   └── index.ts                        # (stub or REAL LOGIC)
├── types.ts                            # Domain type definitions (REAL LOGIC)
└── index.ts                            # Feature barrel export (REAL LOGIC)
```

### Larger Feature Modules

Some features have additional files beyond the standard structure:

- **bookings** (21 files): `bookings.ts`, `allocations.ts`, `blocks.ts`, `bookingAddons.ts`, `availability.ts`, `domain-allocations.ts` in convex/; `use-bookings.ts`, `use-booking-availability.ts` in hooks/
- **auth** (27 files): `sessions.ts`, `callback.ts`, `claims.ts`, `demoToken.ts`, `link.ts`, `magicLink.ts`, `oauthStates.ts`, `password.ts`, `start.ts`, `seedTestUsers.ts` in convex/
- **listings** (27 files): `search.ts`, `favorites.ts` facades; `use-listings.ts`, `use-search.ts`, `use-amenities.ts`, `use-favorites.ts`, `use-geocode.ts` hooks
- **seasons** (21 files): `seasons.ts`, `seasonalLeases.ts`, `seasonApplications.ts` facades

---

## scripts/ -- Build and Utility Scripts (14 files)

```
scripts/
├── ci/                                 # Continuous integration
│   └── verify-domain-bundles.ts       # Validates feature module completeness
├── eslint-rules/                       # Custom ESLint rules (5 files)
│   ├── index.js                        # Rule registry
│   ├── no-css-in-apps.js             # Prevent CSS in app layer
│   ├── no-direct-digdir.js           # Enforce DS wrapper usage
│   ├── no-domain-ui-in-backoffice.js # Layer boundary enforcement
│   ├── no-hardcoded-strings.js       # Enforce i18n
│   └── sdk-usage-contract.js         # SDK import rules
├── codegen.ts                          # Code generation utilities
├── deploy.sh                           # Production deployment script
├── deploy-config.sh                    # Deployment configuration
├── dev.sh                              # Development startup script
├── nginx-subdomains.conf              # Nginx reverse proxy config
├── scan-secrets-usage.sh              # Security: detect hardcoded secrets
├── seed-images-to-convex.ts           # Upload seed images to Convex storage
├── seed-test-tenant.ts                # Create test tenant data
├── server-setup.sh                    # Server provisioning
├── setup-local.sh                     # Local development setup
├── setup-ssl.sh                       # SSL certificate setup
└── test.sh                            # Test runner script
```

---

## tests/ -- Test Suites (34 files)

```
tests/
├── convex/                             # Convex function tests (28 test files)
│   ├── setup.ts                        # Test harness setup
│   ├── auth.test.ts                    # Auth function tests
│   ├── auth-oauth.test.ts            # OAuth flow tests
│   ├── bookings.test.ts               # Booking CRUD tests
│   ├── booking-modes.test.ts          # Booking mode tests
│   ├── bookingAddons.test.ts          # Booking addon tests
│   ├── blocks.test.ts                 # Calendar block tests
│   ├── calendar-opening-hours.test.ts # Opening hours tests
│   ├── resources.test.ts              # Resource management tests
│   ├── categories.test.ts             # Category tests
│   ├── amenities.test.ts              # Amenity tests
│   ├── reviews.test.ts                # Review + moderation tests (not shown, via reviews)
│   ├── pricing.test.ts                # Pricing tests
│   ├── billing.test.ts                # Billing tests
│   ├── vipps-payment.test.ts          # Vipps payment integration
│   ├── seasons.test.ts                # Season management tests
│   ├── addons.test.ts                 # Addon tests
│   ├── messaging.test.ts              # Messaging tests
│   ├── notifications.test.ts          # Notification tests
│   ├── favorites.test.ts              # Favorites tests
│   ├── organizations.test.ts          # Organization tests
│   ├── users.test.ts                  # User management tests
│   ├── tenants.test.ts                # Tenant tests
│   ├── rbac.test.ts                   # RBAC tests
│   ├── compliance.test.ts             # Compliance tests
│   ├── integrations.test.ts           # Integration tests
│   ├── modules.test.ts                # Module enablement tests
│   ├── monitoring.test.ts             # Monitoring/ops tests
│   ├── integration.test.ts            # Cross-domain integration tests
│   └── e2e/                            # E2E backend test suites
│       └── runner.ts                   # Custom test runner
│
├── e2e/                                # Playwright browser E2E tests (6 files)
│   ├── booking-flow.spec.ts           # End-to-end booking flow
│   ├── booking-modes.spec.ts          # Booking mode testing
│   ├── booking-user-journeys.spec.ts  # User journey scenarios
│   ├── booking-workflow.e2e.ts        # Workflow testing
│   ├── admin-workflow.e2e.ts          # Admin workflow testing
│   ├── reviews.spec.ts                # Review E2E tests
│   └── helpers/                        # Test helper utilities
│
├── TEST_PLAN.md                        # Test strategy documentation
├── tsconfig.json                       # Test TypeScript config
└── vitest.config.ts                    # Vitest configuration
```

---

## self-hosted-convex/ -- Self-Hosted Deployment (5 files)

```
self-hosted-convex/
├── docker-compose.yml                  # Docker Compose for self-hosted Convex
├── Caddyfile                           # Caddy reverse proxy config
├── nginx-convex.conf                   # Nginx reverse proxy config
├── deploy.sh                           # Self-hosted deployment script
└── .env                                # Self-hosted environment variables
```

---

## Other Root Files

```
data/
└── rental-objects-comprehensive.json   # Comprehensive seed data (JSON)

public/
└── seed-images/                        # Seed images organized by category
    ├── arrangement/
    ├── Bibliotek/
    ├── Grendehus og sammfunnshus/
    ├── Gymsal/
    ├── Idrettshaller/
    ├── Kulturhus/
    ├── lokaler-og-baner/
    ├── Selskapslokaler/
    ├── Svømmehall/
    ├── møterom/
    ├── Møterom og kursrom/
    └── utstyr/

patches/
└── @xala-technologies__platform-ui.patch  # pnpm patch override

.github/workflows/
└── ci.yml                              # GitHub Actions CI pipeline
```

---

## File Count Summary

| Directory | Source Files | Real Logic | Re-exports | Generated |
|-----------|-------------|------------|------------|-----------|
| `packages/shared/src/features/` | 392 | ~300 | ~10 | ~82 |
| `packages/sdk/src/` | 58 | ~20 | ~35 | ~3 |
| `packages/ds/src/` | 106 | ~106 | 0 | 0 |
| `packages/app-shell/src/` | 16 | ~16 | 0 | 0 |
| `convex/` (excl. _generated) | ~200 | ~15 | ~150 | 0 |
| `apps/` (all src/) | 84 | ~84 | 0 | 0 |
| `tests/` | 34 | 34 | 0 | 0 |
| `scripts/` | 14 | 14 | 0 | 0 |
| **Total** | **~904** | **~589** | **~195** | **~85** |

The re-export count highlights the architecture's commitment to having a single source of truth in `packages/shared/src/features/`. Roughly 22% of all source files exist solely to satisfy Convex's file-based routing or the SDK's public API surface.
